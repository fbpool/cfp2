<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1st Annual 2025 College Playoff Bracket</title>
    <link rel="shortcut icon" href="https://dl.dropboxusercontent.com/s/d8kuo01repoyfif/favicon.ico?raw=1" />
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 20px; }
        h1 { text-align: center; margin-bottom: 20px; }
        .bracket-container { display: grid; grid-template-columns: repeat(4, 240px); gap: 40px; justify-content: start; overflow-x: auto; padding-bottom: 20px; }
        .headings { display: contents; }
        .heading { font-weight: bold; text-align: center; margin-bottom: 0px; font-size: 1.1em; }
        .subheading { font-weight: normal; font-size: 0.9em; color: #555; }
        .round { display: flex; flex-direction: column; justify-content: space-around; }
        .game { background: white; border: 2px solid #ccc; border-radius: 6px; padding: 10px; transition: 0.2s; }
        .game.missing { border-color: red; }
        .team { height: 42px; line-height: 42px; background: #eee; border: 1px solid #aaa; border-radius: 4px; margin-top: 6px; padding-left: 8px; cursor: pointer; transition: 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .team:first-child { margin-top: 0; }
        .team:hover { background: #d4ffd4; }
        .selected { background: #9aff9a !important; border-color: #3c8c3c !important; }
        .form-container { margin-top: 20px; text-align: center; }
        input[type="text"], input[type="email"], input[type="number"] { padding: 8px; width: 220px; margin: 5px; font-size: 1em; }
        button { padding: 10px 20px; font-size: 1em; cursor: pointer; }
        #validationMessage { color: red; text-align: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<h1>1st Annual 2025 College Playoff Bracket</h1>
<p>Pick the winner of each game. The most correct responses wins. $20 per sheet and you can play as many sheets as you like. Payouts will be determined based on the number of people in the pool. Payments can be sent to: Venmo @dan-giusti | Apple Pay 617-312-8199 | Cashapp namg81<br><br>

<div class="bracket-container">
  <div class="headings">
    <div class="heading">Round 1</div>
    <div class="heading">Quarterfinals</div>
    <div class="heading">Semifinals<br /></div>
    <div class="heading">National Championship</div>
  </div>

  <div class="round">
    <div class="game" data-game="R1G1">
      <div class="team" onclick="selectTeam('R1G1','Oregon')">#5 Oregon</div>
      <div class="team" onclick="selectTeam('R1G1','James Madison')">#12 James Madison</div>
    </div>
    <div class="game" data-game="R1G2">
      <div class="team" onclick="selectTeam('R1G2','Oklahoma')">#8 Oklahoma</div>
      <div class="team" onclick="selectTeam('R1G2','Alabama')">#9 Alabama</div>
    </div>
    <div class="game" data-game="R1G3">
      <div class="team" onclick="selectTeam('R1G3','Ole Miss')">#6 Ole Miss</div>
      <div class="team" onclick="selectTeam('R1G3','Tulane')">#11 Tulane</div>
    </div>
    <div class="game" data-game="R1G4">
      <div class="team" onclick="selectTeam('R1G4','Texas A&M')">#7 Texas A&M</div>
      <div class="team" onclick="selectTeam('R1G4','Miami')">#10 Miami</div>
    </div>
  </div>

  <div class="round">
    <div class="game" data-game="QF1">
      <div class="team" id="QF1T1" onclick="selectTeam('QF1', getWinnerName('R1G1'))"></div>
      <div class="team" onclick="selectTeam('QF1','Texas Tech')">#4 Texas Tech</div>
    </div>
    <div class="game" data-game="QF2">
      <div class="team" id="QF2T1" onclick="selectTeam('QF2', getWinnerName('R1G2'))"></div>
      <div class="team" onclick="selectTeam('QF2','Indiana')">#1 Indiana</div>
    </div>
    <div class="game" data-game="QF3">
      <div class="team" id="QF3T1" onclick="selectTeam('QF3', getWinnerName('R1G3'))"></div>
      <div class="team" onclick="selectTeam('QF3','Georgia')">#3 Georgia</div>
    </div>
    <div class="game" data-game="QF4">
      <div class="team" id="QF4T1" onclick="selectTeam('QF4', getWinnerName('R1G4'))"></div>
      <div class="team" onclick="selectTeam('QF4','Ohio State')">#2 Ohio State</div>
    </div>
  </div>

  <div class="round">
      <div class="game" data-game="SF1">
          <div class="team" id="SF1T1" onclick="selectTeam('SF1', getWinnerName('QF1'))"></div>
          <div class="team" id="SF1T2" onclick="selectTeam('SF1', getWinnerName('QF2'))"></div>
      </div>
      <div class="game" data-game="SF2">
          <div class="team" id="SF2T1" onclick="selectTeam('SF2', getWinnerName('QF3'))"></div>
          <div class="team" id="SF2T2" onclick="selectTeam('SF2', getWinnerName('QF4'))"></div>
      </div>
  </div>

  <div class="round">
      <div class="game" data-game="CH">
          <div class="team" id="CHT1" onclick="selectTeam('CH', getWinnerName('SF1'))"></div>
          <div class="team" id="CHT2" onclick="selectTeam('CH', getWinnerName('SF2'))"></div>
      </div>
  </div>
</div>

<div id="validationMessage"></div>

<div class="form-container">
    <input type="number" id="TP" placeholder="Championship Total Points" min="0" max="999" />
    <br/>
    <input type="text" id="name" placeholder="Name" />
    <input type="email" id="email" placeholder="Email" />
    <br/>
    <button onclick="validateAndSubmit()">Submit</button>
</div>

<script>
const teams = {
    "Indiana": {seed: 1, name: "Indiana"}, "Ohio State": {seed: 2, name: "Ohio State"},
    "Georgia": {seed: 3, name: "Georgia"}, "Texas Tech": {seed: 4, name: "Texas Tech"},
    "Oregon": {seed: 5, name: "Oregon"}, "Ole Miss": {seed: 6, name: "Ole Miss"},
    "Texas A&M": {seed: 7, name: "Texas A&M"}, "Oklahoma": {seed: 8, name: "Oklahoma"},
    "Alabama": {seed: 9, name: "Alabama"}, "Miami": {seed: 10, name: "Miami"},
    "Tulane": {seed: 11, name: "Tulane"}, "James Madison": {seed: 12, name: "James Madison"}
};

let winners = {};
let triedSubmit = false;
let lastSubmissionData = null;

const nextGames = {
    "R1G1": ["QF1T1"], "R1G2": ["QF2T1"], "R1G3": ["QF3T1"], "R1G4": ["QF4T1"],
    "QF1": ["SF1T1"], "QF2": ["SF1T2"], "QF3": ["SF2T1"], "QF4": ["SF2T2"],
    "SF1": ["CHT1"], "SF2": ["CHT2"]
};

const entryIDs = {
    "name": "257403214", "email": "710747034", "R1G1": "3192731", "R1G2": "228298947",
    "R1G3": "211151388", "R1G4": "1001170552", "QF1": "1411199850", "QF2": "367488223",
    "QF3": "802216188", "QF4": "7428646", "SF1": "29966834", "SF2": "1434513780",
    "CH": "111311380", "TP": "1824678700"
};

// --- RESTORED ORIGINAL LOGIC ---
function getWinner(game) { return winners[game] || ""; }
function getSeededName(teamName) { if (!teamName) return ""; return teams[teamName] ? "#" + teams[teamName].seed + " " + teams[teamName].name : teamName; }
function getWinnerName(game) { return getWinner(game); }

function clearDownstream(game) {
    if (!nextGames[game]) return;
    const advancingTeam = winners[game];
    nextGames[game].forEach(slotId => {
        const slotEl = document.getElementById(slotId);
        if (!slotEl) return;
        const parentGameEl = slotEl.closest('.game');
        const parentGame = parentGameEl.dataset.game;
        slotEl.textContent = getSeededName(advancingTeam);
        if (winners[parentGame]) {
            const currentPick = winners[parentGame];
            if (currentPick === advancingTeam) return;
            const fixedTeamsInGame = getFixedTeamsInGame(parentGame);
            if (fixedTeamsInGame.includes(currentPick)) return;
            const sourceGame = getSourceGameForSlot(slotId);
            if (sourceGame === game && currentPick !== advancingTeam) {
                delete winners[parentGame];
                clearDownstream(parentGame);
            }
        }
    });
}

function getFixedTeamsInGame(game) {
    const fixed = [];
    const gameEl = document.querySelector(`[data-game="${game}"]`);
    if (!gameEl) return fixed;
    gameEl.querySelectorAll('.team').forEach(teamEl => {
        const text = teamEl.textContent.trim();
        if (text && !text.includes('â†’') && text.match(/^#\d+/)) {
            const teamName = text.replace(/^#\d+\s+/, '');
            fixed.push(teamName);
        }
    });
    return fixed;
}

function getSourceGameForSlot(slotId) {
    const map = { "QF1T1": "R1G1", "QF2T1": "R1G2", "QF3T1": "R1G3", "QF4T1": "R1G4", "SF1T1": "QF1", "SF1T2": "QF2", "SF2T1": "QF3", "SF2T2": "QF4", "CHT1": "SF1", "CHT2": "SF2" };
    return map[slotId] || null;
}

function selectTeam(game, team) {
    if (!team) return;
    const oldWinner = winners[game];
    if (oldWinner !== team) {
        winners[game] = team;
        clearDownstream(game);
        renderBracket();
        updateValidationMessage();
    } else {
        renderBracket();
    }
}

function renderBracket() {
    document.querySelectorAll('.team').forEach(el => el.classList.remove('selected'));
    for (const [game, winner] of Object.entries(winners)) {
        const gameBox = document.querySelector(`[data-game="${game}"]`);
        if (!gameBox) continue;
        [...gameBox.querySelectorAll('.team')].forEach(el => {
            if (el.textContent === getSeededName(winner)) el.classList.add('selected');
        });
    }
    ["QF1T1","QF2T1","QF3T1","QF4T1"].forEach(id => { document.getElementById(id).textContent = getSeededName(getWinner(getSourceGameForSlot(id))); });
    ["SF1T1","SF1T2","SF2T1","SF2T2"].forEach(id => { document.getElementById(id).textContent = getSeededName(getWinner(getSourceGameForSlot(id))); });
    ["CHT1","CHT2"].forEach(id => { document.getElementById(id).textContent = getSeededName(getWinner(getSourceGameForSlot(id))); });
}

function updateValidationMessage() {
    if (!triedSubmit) return;
    const allGames = ["R1G1","R1G2","R1G3","R1G4","QF1","QF2","QF3","QF4","SF1","SF2","CH"];
    const validationMessage = document.getElementById("validationMessage");
    let valid = true;
    allGames.forEach(g => {
        const el = document.querySelector(`[data-game="${g}"]`);
        el.classList.remove("missing");
        if (!winners[g]) { el.classList.add("missing"); valid = false; }
    });
    const tp = document.getElementById("TP").value.trim();
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    if (!tp || !name || !email) valid = false;
    validationMessage.style.color = valid ? "green" : "red";
    validationMessage.textContent = valid ? "All selections made! Ready to submit." : "Please complete all fields and picks.";
}

async function validateAndSubmit() {
    triedSubmit = true;
    updateValidationMessage();
    if (document.getElementById("validationMessage").style.color !== "green") return;

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const tp = document.getElementById("TP").value.trim();

    const formPayload = { [`entry.${entryIDs.name}`]: name, [`entry.${entryIDs.email}`]: email, [`entry.${entryIDs.TP}`]: tp };
    for (const [game, winner] of Object.entries(winners)) { if (entryIDs[game]) formPayload[`entry.${entryIDs[game]}`] = winner; }

    try {
        await fetch("https://docs.google.com/forms/d/e/1FAIpQLSe6ak-5Hl4Cui5nGmhZWNtipwdP2OpskMtST3lH_d-rNDylqw/formResponse", {
            method: "POST", mode: "no-cors", headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formPayload)
        });
        document.getElementById("validationMessage").textContent = "Submission sent! Good luck!";
    } catch (err) { console.error(err); }
}

// --- NEW INITIALIZATION FROM URL ---
window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    ["name", "email", "TP"].forEach(id => { if (params.has(id)) document.getElementById(id).value = params.get(id); });
    const order = ["R1G1","R1G2","R1G3","R1G4","QF1","QF2","QF3","QF4","SF1","SF2","CH"];
    order.forEach(game => { if(params.has(game)) selectTeam(game, params.get(game)); });
});
</script>
</body>
</html>
